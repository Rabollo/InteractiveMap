//  app.js//  InterActiveMap - Wroclaw//  //  Created by ISMAIL BULUC on 2015-05-06.//  Copyright 2015 ISMAIL BULUC. All rights reserved.//var MapModule = require('ti.map');var xhr = Titanium.Network.createHTTPClient();var IDArray = [];var IDArray2 = [];var annotationL = [];var placeID; var iAmLookingFor = Titanium.UI.createWindow({ backgroundColor: '#fff', title: 'I\'m looking for' });var details2 = Titanium.UI.createWindow({ backgroundColor: 'red', title: 'Blue Window' });var searchWindow = Titanium.UI.createWindow({ backgroundColor:'#fff', title: 'Search Window' });var savedWindow = Titanium.UI.createWindow({ title:'Saved Places', backgroundColor:'#fff'});var mapWindow = Titanium.UI.createWindow({ backgroundColor:'#fff', title: 'History Window' });var meWindow = Titanium.UI.createWindow({ title:'Me Places', backgroundColor:'#fff' });Ti.include("functions/createDetailsWindowObjects.js");Ti.include("functions/loadList.js");Ti.include("functions/createButtons.js");Ti.include("functions/sendRating.js");Ti.include("functions/saveplace.js");Ti.include("functions/sendComment.js");Ti.include("functions/createRatingButtons.js");Ti.include("functions/createDetailsWindowLoadComments.js");Ti.include("functions/loadSavedPlaces.js");Ti.include("functions/removeSavedPlace.js");Ti.include("functions/loadMap.js");var button = Titanium.UI.createButton({ title: 'Restaurant Details' });// create tab groupvar tabGroup = Titanium.UI.createTabGroup({ title: 'Main Page'});tabGroup.addEventListener ('focus', function (e) {	if(e.index == 0){ loadList("all");	}else if(e.index == 1){		loadSavedPlacesList(userID);	}else if(e.index == 2){		loadMap("all");	}else if(e.index == 3){				var userlogo = Ti.UI.createImageView({			image : "http://graph.facebook.com/"+userID+"/picture/",			width : 100,			height : 100,			top : 50,			left : 110		});		meWindow.add(userlogo);		
		var userNameLabel = Ti.UI.createLabel({
			text : 'ISMAIL SAHIN',
			color : 'black',
			font : {fontSize:20},
			height : 30,width : "auto",
			top : 170,left : 100,
			textAlign : 'center'
		});
		meWindow.add(userNameLabel);
			   var facebookLoginButton = Titanium.Facebook.createLoginButton({ 			top: 250,			left: 70,		    height: 50,			width: 250, 			style: Ti.Facebook.BUTTON_STYLE_WIDE  		});		meWindow.add(facebookLoginButton);	}});// Leave a tip Windowsvar leaveATip = Titanium.UI.createWindow({ backgroundColor: '#fff', title: 'Leave a Tip' });var navWin = Ti.UI.iOS.createNavigationWindow({	//modal:true,	window: leaveATip});// Create windowsvar details = Titanium.UI.createWindow({ backgroundColor: '#fff', title: 'Details' });var scrollViewDetailsWindow = Ti.UI.createScrollView({	backgroundColor:"White", height: '100%', width: '100%',	showVerticalScrollIndicator: true, showHorizontalScrollIndicator: true,});details.add(scrollViewDetailsWindow);// Create Tabsvar tab1 = Titanium.UI.createTab({    icon:'img/1430944907_common_search_lookup_-16.png',    title:'Search',    window:searchWindow,    backgroundColor:'blue',});var tab2 = Titanium.UI.createTab({    icon:'img/1430944985_Noun_Project_100Icon_10px_grid-38-16.png',    title:'Saved',    window:savedWindow,    backgroundColor:'blue',});var tab3 = Titanium.UI.createTab({    icon:'img/1433418519_icon-map.png',    title:'Map',    window:mapWindow,    backgroundColor:'blue',});var tab4 = Titanium.UI.createTab({    icon:'img/1430945019_hire-me.png',    title:'Me',    window:meWindow,    backgroundColor:'blue'});// Add TabstabGroup.addTab(tab1);  tabGroup.addTab(tab2);tabGroup.addTab(tab3);  tabGroup.addTab(tab4);// open tab grouptabGroup.open();    // Button Setvar buttonSet = Titanium.UI.createButtonBar({    labels:[{title:'',image:'img/all.png'},// Restaurants    {title:'',image:'img/1430944524_Streamline-99-16.png'},// Restaurants    {title:'',image:'img/1430944547_food-drink_cup_coffee_tea_drink-16.png'},// Caffe    {title:'',image:'img/1430944540_food-drink_cocktail_wine_glass_outing_drink-16.png'},// bars    {title:'',image:'img/1430944645_Mask.png'},// fun     {title:'',image:'img/1430944880_grid-dot.png'}],// All Buttons    top:0, height:40,    width:"100%"});searchWindow.add(buttonSet);buttonSet.addEventListener('click', function(e) {        if (e.index == 0){ loadList("all");	} else if (e.index == 1){ loadList("lunch");	} else if (e.index == 2){ loadList("coffee");	} else if (e.index == 3){ loadList("bar");	} else if (e.index == 4){ loadList("fun");	} else if (e.index == 5){ tab1.open(iAmLookingFor, {animated:true}); createButtons(); }});//Create Searchvar search = Titanium.UI.createSearchBar({    barColor:'#fff',    showCancel:false,    height:40,    top:0,    hintText: 'Search...'});searchWindow.add(search);//Create table Viewvar table = Ti.UI.createTableView({		top:'45',		backgroundColor:'white',		search: search,        hideSearchOnSelection: true});table.addEventListener('click',function(e){	tab1.open(details, {animated:true},createDetailsWindowObjects(IDArray[e.index]));});searchWindow.add(table);//Create table Viewvar savedWindowTable = Ti.UI.createTableView({		top:'45',		backgroundColor:'white',		search: search,        hideSearchOnSelection: true,        editable:true});savedWindowTable.addEventListener('delete',function(e){ 	//alert("!" + IDArray2[e.index] +" UID: "+ userID); 	removeSavedPlace(IDArray2[e.index],userID); 	IDArray2.splice(e.index,1);});savedWindowTable.addEventListener('click',function(e){ 	tab2.open(details, {animated:true},createDetailsWindowObjects(IDArray[e.index])); 	//alert("!" + IDArray2[e.index] +" UID: "+ userID);});savedWindow.add(savedWindowTable);var textLabel = Ti.UI.createLabel({	text:"	Best places in the area",	font:{fontSize:18}, color:"blue",	top:40,paddingLeft:"20",	width:"100%",height:"10%",	backgroundColor:"white"});searchWindow.add(textLabel);var textLabel2 = Ti.UI.createLabel({	text:"	Your favourate places...",	font:{fontSize:22}, color:"blue",	top:40,paddingLeft:"20",	width:"100%",height:"10%",	backgroundColor:"white"});savedWindow.add(textLabel2);var searchButton = Titanium.UI.createButton({ // Change Image !!!    image: 'img/1430944907_common_search_lookup_-16.png'});searchWindow.setRightNavButton(searchButton);searchButton.addEventListener('click', function(){   buttonSet.hide();   search.show();});buttonSet.show();search.hide();var buttonSetButton = Titanium.UI.createButton({ // Change Image !!!    image: 'img/1430944956_ui-buttons.png'});searchWindow.setLeftNavButton(buttonSetButton);buttonSetButton.addEventListener('click', function(){   buttonSet.show();   search.hide();}); // ******************// *** Map Window ***// ******************var MainMapView = MapModule.createView({	mapType: MapModule.NORMAL_TYPE,	userLocation:true,    visible: true,});mapWindow.add(MainMapView);MainMapView.addEventListener('click', function(evt){        // get event properties        var annotation = evt.annotation.myid; //get the Myid from annotation        var clicksource = evt.clicksource;         		        if (clicksource=='leftButton'){  //leftButton event                  tab3.open(details, {animated:true},createDetailsWindowObjects(annotation));        }        if (clicksource=='title'){   //title event            alert("title of " + annotation + " has been clicked.");                         }           });function getLocation(){//Get the current position and set it to the mapview	Titanium.Geolocation.getCurrentPosition(function(e){	        var region={	            latitude: e.coords.latitude,	            longitude: e.coords.longitude,	            animate:true,	            latitudeDelta:0.01,	            longitudeDelta:0.01	        };	        MainMapView.setLocation(region);	});}getLocation();//Titanium.Geolocation.addEventListener('location',function(){  });